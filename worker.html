<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Village Help â€“ Worker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{font-family:Arial;background:#f2f2f2}
.box{max-width:420px;margin:auto;background:#fff;padding:20px;margin-top:20px;border-radius:10px}
input,button{width:100%;padding:10px;margin-top:10px}
button{background:#28a745;color:#fff;border:none}
.card{background:#eef6ff;padding:10px;margin-top:10px;border-radius:6px}
.call{background:#007bff;margin-top:5px}
</style>
</head>

<body>

<div class="box" id="loginBox">
<h2>Worker Login</h2>
<input id="mobile" placeholder="Mobile Number">
<button onclick="login()">Login</button>
</div>

<div class="box" id="panel" style="display:none;">
<h2>My Bookings</h2>
<div id="list"></div>
</div>

<script>
const firebaseConfig={
apiKey:"AIzaSyDOBjOo5YsBndo8HPQv66ClmthIHqf0gmw",
authDomain:"village-help-6dda3.firebaseapp.com",
projectId:"village-help-6dda3",
storageBucket:"village-help-6dda3.firebasestorage.app",
messagingSenderId:"242196617492",
appId:"1:242196617492:web:a1dde8b7a42088f75b0a01"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();
let workerMobile="";

async function login(){
workerMobile=mobile.value.trim();
if(workerMobile.length!==10){alert("Invalid number");return;}

const snap=await db.collection("workers")
.where("mobile","==",workerMobile)
.where("active","==",true).limit(1).get();

if(snap.empty){alert("à¤†à¤ª registered worker à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆà¤‚");return;}

loginBox.style.display="none";
panel.style.display="block";
loadBookings();
}

function loadBookings(){
db.collection("bookings")
.where("workerMobile","==",workerMobile)
.onSnapshot(s=>{
list.innerHTML="";
if(s.empty){list.innerHTML="No bookings";return;}
s.forEach(d=>{
const b=d.data();
list.innerHTML+=`
<div class="card">
<b>${b.service}</b><br>
${b.name} (${b.mobile})<br>
Status: ${b.status}<br>
<a href="tel:${b.mobile}">
<button class="call">ðŸ“ž Call</button>
</a>
</div>`;
});
});
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>Village Help</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body { font-family: Arial; background:#f2f2f2; }
    .container { max-width:420px; margin:auto; background:#fff; padding:20px; margin-top:20px; border-radius:10px; }
    input, select, button { width:100%; padding:10px; margin-top:10px; }
    button { background:#28a745; color:#fff; border:none; font-size:18px; }
    .confirm { display:none; background:#e8f8f5; padding:15px; margin-top:15px; }
    .call { background:#007bff; margin-top:10px; }
  </style>
</head>

<body>
<div class="container">
  <h2>Village Help</h2>

  <select id="service">
    <option value="">Service ‡§ö‡•Å‡§®‡•á‡§Ç</option>
    <option>Electrician</option>
    <option>Plumber</option>
  </select>

  <input id="name" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ">
  <input id="mobile" placeholder="Mobile ‡§®‡§Ç‡§¨‡§∞">
  <input id="village" placeholder="‡§ó‡§æ‡§Å‡§µ ‡§ï‡§æ ‡§®‡§æ‡§Æ">

  <button onclick="book()">Service Book ‡§ï‡§∞‡•á‡§Ç</button>

  <div class="confirm" id="confirm">
    <h3>‚úÖ Booking Confirm</h3>
    <p id="info"></p>
    <a id="callWorker"><button class="call">üìû Worker ‡§ï‡•ã Call ‡§ï‡§∞‡•á‡§Ç</button></a>
    <a href="tel:9999999999"><button class="call">üìû Admin ‡§ï‡•ã Call ‡§ï‡§∞‡•á‡§Ç</button></a>
  </div>
</div>

<script>
  // ‚úÖ Firebase Config (FINAL ‚Äì CONNECTED)
  const firebaseConfig = {
    apiKey: "AIzaSyByMmFPEZEH6ECLKNHyL6RdvNrY-zWHBpU",
    authDomain: "village-help.firebaseapp.com",
    projectId: "village-help",
    storageBucket: "village-help.firebasestorage.app",
    messagingSenderId: "639842342038",
    appId: "1:639842342038:web:7effe000ed9bae0fc31eb7",
    measurementId: "G-EQT8S6Y8PD"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  async function book() {
    let service = document.getElementById("service").value;
    let name = document.getElementById("name").value;
    let mobile = document.getElementById("mobile").value;
    let village = document.getElementById("village").value;

    if (!service || !name || !mobile || !village) {
      alert("‡§∏‡§≠‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç");
      return;
    }

    let workerSnap = await db.collection("workers")
      .where("service", "==", service)
      .where("active", "==", true)
      .limit(1)
      .get();

    if (workerSnap.empty) {
      alert("‡§Ö‡§≠‡•Ä worker ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à");
      return;
    }

    let worker = workerSnap.docs[0].data();

    await db.collection("bookings").add({
      name,
      mobile,
      village,
      service,
      workerName: worker.name,
      workerMobile: worker.mobile,
      time: new Date()
    });

    document.getElementById("info").innerHTML = `
      <b>Service:</b> ${service}<br>
      <b>Worker:</b> ${worker.name}<br>
      <b>Village:</b> ${village}
    `;

    document.getElementById("callWorker").href = "tel:" + worker.mobile;
    document.getElementById("confirm").style.display = "block";
  }
</script>
</body>
</html>

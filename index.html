<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Village Help ‚Äì Customer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{font-family:Arial;background:#f2f2f2}
.box{max-width:420px;margin:auto;background:#fff;padding:20px;margin-top:20px;border-radius:10px}
input,select,button{width:100%;padding:10px;margin-top:10px}
button{border:none}
.green{background:#28a745;color:#fff}
.blue{background:#007bff;color:#fff}
.red{background:#dc3545;color:#fff}
.card{background:#eef6ff;padding:10px;margin-top:10px;border-radius:6px}
</style>
</head>

<body>

<div class="box" id="authBox">
<h2>Customer Login / Signup</h2>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button class="green" onclick="signup()">Sign Up</button>
<button class="blue" onclick="login()">Login</button>
</div>

<div class="box" id="app" style="display:none;">
<h2>Village Help</h2>

<select id="service">
<option value="">Service ‡§ö‡•Å‡§®‡•á‡§Ç</option>
<option>Electrician</option>
<option>Plumber</option>
</select>

<input id="name" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ">
<input id="mobile" placeholder="Mobile Number">
<input id="village" placeholder="‡§ó‡§æ‡§Å‡§µ">

<button class="green" onclick="book()">Service Book ‡§ï‡§∞‡•á‡§Ç</button>
<button class="red" onclick="logout()">Logout</button>

<hr>
<h3>üìú Booking History</h3>
<div id="history"></div>
</div>

<script>
const firebaseConfig={
apiKey:"AIzaSyDOBjOo5YsBndo8HPQv66ClmthIHqf0gmw",
authDomain:"village-help-6dda3.firebaseapp.com",
projectId:"village-help-6dda3",
storageBucket:"village-help-6dda3.firebasestorage.app",
messagingSenderId:"242196617492",
appId:"1:242196617492:web:a1dde8b7a42088f75b0a01"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();

function signup(){
auth.createUserWithEmailAndPassword(email.value,password.value)
.then(()=>alert("Signup successful"))
.catch(e=>alert(e.message));
}

function login(){
auth.signInWithEmailAndPassword(email.value,password.value)
.catch(e=>alert(e.message));
}

function logout(){auth.signOut();}

auth.onAuthStateChanged(u=>{
if(u){authBox.style.display="none";app.style.display="block";loadHistory();}
else{authBox.style.display="block";app.style.display="none";}
});

async function book(){
if(!service.value||!name.value||!mobile.value||!village.value){
alert("‡§∏‡§≠‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç");return;
}
const snap=await db.collection("workers")
.where("service","==",service.value)
.where("active","==",true).limit(1).get();

if(snap.empty){alert("‡§Ö‡§≠‡•Ä worker ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à");return;}

const w=snap.docs[0].data();

await db.collection("bookings").add({
uid:auth.currentUser.uid,
name:name.value,
mobile:mobile.value,
village:village.value,
service:service.value,
workerName:w.name,
workerMobile:w.mobile,
status:"pending",
time:new Date()
});
alert("Booking successful");
loadHistory();
}

function loadHistory(){
db.collection("bookings")
.where("uid","==",auth.currentUser.uid)
.orderBy("time","desc")
.onSnapshot(s=>{
history.innerHTML="";
if(s.empty){history.innerHTML="No bookings";return;}
s.forEach(d=>{
const b=d.data();
history.innerHTML+=`
<div class="card">
<b>${b.service}</b><br>
Worker: ${b.workerName}<br>
Status: ${b.status}<br>
<a href="tel:${b.workerMobile}">
<button class="blue">üìû Call Worker</button>
</a>
</div>`;
});
});
}
</script>
</body>
</html>
